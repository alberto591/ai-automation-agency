export const appraisalCache={storage:new Map,ttl:9e5,generateKey:e=>`${e.city}_${e.zone}_${e.surface_sqm}_${e.condition}`,get(e){const t=this.storage.get(this.generateKey(e));return!t||Date.now()-t.timestamp>this.ttl?null:t.data},set(e,t){this.storage.set(this.generateKey(e),{data:t,timestamp:Date.now()})}};export function formatPhoneNumber(e){let t=e.value.replace(/\s/g,"");if(t.startsWith("3")&&!t.startsWith("+")&&(t="+39"+t),t.startsWith("+39")&&t.length>5){const e=t.substring(3);e.length>3&&(t=`+39 ${e.substring(0,3)} ${e.substring(3)}`)}e.value=t}export function formatPostalCode(e){let t=e.value.replace(/[^0-9]/g,"").substring(0,5);e.value=t}export function showLoadingProgress(e,t){let n=document.getElementById("loading-overlay");n||(n=document.createElement("div"),n.id="loading-overlay",n.innerHTML='\n            <div class="loading-content">\n                <div class="loading-spinner"></div>\n                <div class="loading-message" id="loading-message"></div>\n                <div class="progress-bar-container">\n                    <div class="progress-bar" id="progress-bar"></div>\n                </div>\n                <div class="progress-text" id="progress-text">0%</div>\n            </div>\n        ',document.body.appendChild(n)),n.classList.add("active"),document.getElementById("loading-message").textContent=e,document.getElementById("progress-bar").style.width=`${t}%`,document.getElementById("progress-text").textContent=`${Math.round(t)}%`}export function hideLoadingProgress(){const e=document.getElementById("loading-overlay");e&&e.classList.remove("active")}export function displayAppraisalResults(e,n){document.querySelector(".appraisal-form-box").style.display="none";document.getElementById("appraisal-result").style.display="block";const a=e.investment_metrics||{},s=e.estimated_value>0,r=document.getElementById("no-data-alert"),i=document.getElementById("value-range");r&&i&&(r.style.display=s?"none":"flex",i.style.display=s?"block":"none");const o=document.getElementById("confidence-text");if(o)if(s&&e.confidence_level){const t="â­".repeat(e.reliability_stars||3);o.textContent=`${t} (${e.confidence_level}%)`}else o.textContent=t("appraisal-res-confidence-low");const l=e.reasoning?.includes("TEST MODE");l?(document.getElementById("res-min").innerHTML=(e.estimated_range_min||0).toLocaleString(),document.getElementById("res-max").innerHTML=(e.estimated_range_max||0).toLocaleString(),document.getElementById("res-sqm").innerHTML=(e.avg_price_sqm||0).toLocaleString(),a&&Object.keys(a).length>0&&s&&(document.getElementById("res-rent").innerHTML=(a.monthly_rent||0).toLocaleString(),document.getElementById("res-yield").innerHTML=(a.cap_rate||0).toFixed(1),document.getElementById("res-cap-rate").innerHTML=(a.cap_rate||0).toFixed(1),document.getElementById("res-roi").innerHTML=(a.roi||0).toFixed(1),document.getElementById("res-coc").innerHTML=(a.cash_on_cash_return||0).toFixed(1))):(animateValue("res-min",0,e.estimated_range_min||0,500),animateValue("res-max",0,e.estimated_range_max||0,500),animateValue("res-sqm",0,e.avg_price_sqm||0,500),a&&Object.keys(a).length>0&&s&&(animateValue("res-rent",0,a.monthly_rent||0,500),animateValue("res-yield",0,a.cap_rate||0,500,!0),animateValue("res-cap-rate",0,a.cap_rate||0,500,!0),animateValue("res-roi",0,a.roi||0,500,!0),animateValue("res-coc",0,a.cash_on_cash_return||0,500,!0))),n.innerHTML=`<span data-translate="appraisal-cta">${t("appraisal-cta")}</span> <i class="ph ph-arrow-right"></i>`,n.disabled=!1}export const validators={postalCode:e=>/^[0-9]{5}$/.test(e),phone:e=>/^(\+39|0039|\+34|0034)?[0-9]{9,10}$/.test(e.replace(/\s/g,"")),sqm:e=>{const t=parseInt(e.replace(/,/g,""));return t>=20&&t<=500},address:e=>e.length>=5&&e.length<=200};export function validateField(e,t){const n=e.value,a=t(n);return n?(e.classList.toggle("valid",a),e.classList.toggle("error",!a)):e.classList.remove("valid","error"),a}